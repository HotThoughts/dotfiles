[user]
name = {{ .name | quote }}
email = {{ .email | quote }}

[signing]
behavior = "own"
backend = "gpg"
key = {{ .signingkey | quote }}

[ui]
editor = {{ .editor | quote }}
pager = "delta"
diff-ingstructions = false
diff-editor = ":builtin"
diff-formatter = ":git"

[aliases]
mine = ["bookmark", "list", "-r", "mine()"]
tug = [
  "bookmark",
  "move",
  "--from",
  "closest_bookmark(@)",
  "--to",
  "closest_pushable(@)",
]
rebase-all = ["rebase", "-s", "all:roots(trunk()..mutable())", "-d", "trunk()"]
# Run pre-commit checks before pushing (only on jj-tracked changed files)
pre-commit = [
  "util",
  "exec",
  "--",
  "fish",
  "-c",
  "jj diff -r @ --name-only --no-pager | xargs pre-commit run --files",
]
pr = ["util", "exec", "--", "fish", "-c", "jjpr"]
push = ["util", "exec", "--", "fish", "-c", "jj pre-commit && jj git push"]
push-pr = ["util", "exec", "--", "fish", "-c", "jj pre-commit && jjpr"]

[templates]
git_push_bookmark = '"yw/push-" ++ change_id.short()'

[git]
private-commits = 'blacklist()'
sign-on-push = true
colocate = true

[remote.origin]
auto-track-bookmark = "glob:*"

[snapshot]
auto-update-stale = true

[revset-aliases]
'wip()' = 'description(glob:"wip:*")'
'private()' = 'description(glob:"private:*")'
'blacklist()' = 'wip() | private()'
'closest_bookmark(to)' = 'heads(::to & bookmarks())'
'closest_pushable(to)' = 'heads(::to & ~description(exact:"") & (~empty() | merges()))'

[fix.tools.gofmt]
patterns = ["glob:'**/*.go'"]
command = ["gofmt"]

[fix.tools.prettier]
command = ["prettier", "--stdin-filepath", "$path"]
# run with npx:
#   command = ["npx", "prettier", "--stdin-filepath", "$path"]
# run from node_modules:
#   command = ["$root/node_modules/.bin/prettier", "--stdin-filepath", "$path"]
patterns = [
    "glob:'**/*.js'",
    "glob:'**/*.jsx'",
    "glob:'**/*.ts'",
    "glob:'**/*.tsx'",
    "glob:'**/*.json'",
    "glob:'**/*.html'",
    "glob:'**/*.md'",
    "glob:'**/*.css'",
    ]
[fix.tools.terraform]
command = ["terraform", "fmt", "-"]
patterns = ["glob:'**/*.tf'", "glob:'**/*.tfvars'"]

[fix.tools.yamlfmt]
command = ["yamlfmt", "-in"]
patterns = ["glob:'**/*.yml'", "glob:'**/*.yaml'"]
